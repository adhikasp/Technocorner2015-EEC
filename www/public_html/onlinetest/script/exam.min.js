var timer={max:0,localTime:{remaining:0,now:0},srvTime:{max:0,remaining:0,now:0},tickCallback:null,timeoutCallback:null,tick:function(){0==this.srvTime.max&&this.sync(),this.localTime.now=(new Date).getTime()/1e3,this.localTime.remaining=this.srvTime.max-this.localTime.now,setTimeout(function(){timer.tickCallback(timer.localTime.remaining),timer.localTime.remaining>0?timer.tick(timer.localTime.remaining):timer.timeoutCallback()},1e3)},sync:function(){$.ajax({type:"get",url:"exam/timer",async:!1,success:function(e){timer.srvTime.max=e.max,timer.srvTime.now=e.now,timer.srvTime.remaining=e.remaining},error:function(e){console.error("Timer can't be synced. Will use local time instead. Cause : "+e.message)}})}};$(document).ready(function(){function e(){for(var e=$("div.row.question").get(),i=0;i<e.length;i++){var a=localStorage.getItem(t+"-"+e[i].id);null!=a&&$("#"+e[i].id+" input[value="+a+"]").prop("checked",!0)}}function i(){var e=$("#exam_id").val(),i=$(".exam-paper").attr("data-subjectId");$.ajax({type:"get",url:"/user/exam/get-answer",data:{exam_id:e,subject_id:i},success:function(e){var i=($("div.row.question").get(),e.question);i.forEach(function(e){var i=$(".question#"+e.question_id);i.length&&(i.find("input[value="+e.answer+"]").prop("checked",!0),console.log(i.find("[name="+e.exam_id+"-ch]:checked")))})},error:function(){alert("Jawaban gagal di load dari server, meload dari localStorage")}})}function a(e){var i=[],a=$("#exam_id").val();$(".question").each(function(){var e={},a=this.id;e.id=a,e.answer=$(this).find("[name="+a+"-ch]:checked").val(),e.answer&&i.push(e)}),$.ajax({async:!1,type:"POST",url:"/user/exam/submit",data:{answers:i,exam_id:a},success:function(){alert("sukses"),e()},error:function(){alert("Gagal menyimpan jawaban, harap ulangi klik tombol. Jika hal ini terus terjadi segera hubungi Admin.")}})}$(window).keydown(function(e){return 13==e.keyCode?!1:!0});var t=$("form").attr("id").replace("-paper","");$(".choice-radio").click(function(){var e=$(this).attr("name").split("-")[0],i=$(this).attr("value");localStorage.setItem(t+"-"+e,i)}),e(),i(),timer.tickCallback=function(e){e=Math.floor(e),console.log("callback rem : "+e);var i=Math.floor(e/60/60%24),a=Math.floor(e/60%60),t=Math.floor(e%60),n="timer col-sm-1 ";1==i&&a>40?n+="time-relax":1==i&&a>0?n+="time-running":0==i&&a>20?n+="time-warning":0==i&&20>a&&(n+="time-critical"),console.log("class : "+n+"; m : "+a),$(".timer").attr("class",n),10>i&&(i="0"+i.toString()),10>a&&(a="0"+a.toString()),10>t&&(t="0"+t.toString()),$(".timer").html(i+" : "+a+" : "+t)},timer.timeoutCallback=function(){$("input[type=submit]").trigger("click")},timer.tick(),$(".exam-paper").submit(function(e){e.preventDefault();var i=this;a(i.submit())}),$(".subject-link").on("click",function(e){e.preventDefault();var i=this;a(function(){window.location=i.href})})});